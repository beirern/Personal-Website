---
import type { CollectionEntry } from 'astro:content';
import FormattedDate from './FormattedDate.astro';

export interface Props {
	post: CollectionEntry<'posts'>;
}

const { post } = Astro.props;
const { slug, data, body } = post;

function createExcerpt(content: string, maxLength: number = 200) {
	if (data.excerpt) {
		return data.excerpt;
	}
	
	const stripped = content.replace(/[#*`\[\]()]/g, '');
	return stripped.length > maxLength 
		? stripped.substring(0, maxLength) + '...' 
		: stripped;
}
---

<article class="post-preview">
	<h2><a href={`/posts/${slug}`}>{data.title}</a></h2>
	<div class="post-meta">
		<FormattedDate date={data.date} />
		{data.tags.map((tag) => (
			<span class="tag">
				<a href={`/tags/${tag}`}>#{tag}</a>
			</span>
		))}
	</div>
	<div class="excerpt" set:html={createExcerpt(body)} />
	<a class="read-more" href={`/posts/${slug}`}>Read More</a>
</article>

<style>
	.post-preview {
		padding: 1.5em 0;
		border-bottom: 1px solid #eee;
	}
	
	.post-preview:last-child {
		border-bottom: none;
	}
	
	h2 {
		margin: 0 0 0.5em 0;
		font-size: 1.5rem;
	}
	
	h2 a {
		color: #333;
		text-decoration: none;
		transition: color 0.2s ease;
	}
	
	h2 a:hover {
		color: #0366d6;
	}
	
	.post-meta {
		margin-bottom: 1em;
		color: #666;
		font-size: 0.9rem;
		display: flex;
		align-items: center;
		gap: 1em;
	}
	
	.tag {
		display: inline-block;
	}
	
	.tag a {
		color: #0366d6;
		text-decoration: none;
		font-size: 0.85rem;
	}
	
	.tag a:hover {
		text-decoration: underline;
	}
	
	.excerpt {
		margin-bottom: 1em;
		line-height: 1.6;
		color: #555;
	}
	
	.read-more {
		color: #0366d6;
		text-decoration: none;
		font-weight: 500;
		font-size: 0.9rem;
	}
	
	.read-more:hover {
		text-decoration: underline;
	}
</style>