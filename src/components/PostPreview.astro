---
import type { CollectionEntry } from 'astro:content';

export interface Props {
	post: CollectionEntry<'posts'>;
}

const { post } = Astro.props;
const { slug, data, body } = post;

function formatDate(date: Date) {
	return new Intl.DateTimeFormat('en-US').format(date);
}

function createExcerpt(content: string, maxLength: number = 200) {
	if (data.excerpt) {
		return data.excerpt;
	}
	
	const stripped = content.replace(/[#*`\[\]()]/g, '');
	return stripped.length > maxLength 
		? stripped.substring(0, maxLength) + '...' 
		: stripped;
}
---

<article class="post-preview">
	<h2><a href={`/posts/${slug}`}>{data.title}</a></h2>
	<div class="post-meta">
		<span class="date">{formatDate(data.date)}</span>
		{data.tags.map((tag) => (
			<span class="tag">
				<a href={`/tags/${tag}`}>#{tag}</a>
			</span>
		))}
	</div>
	<div class="excerpt" set:html={createExcerpt(body)} />
	<a class="read-more" href={`/posts/${slug}`}>Read More</a>
</article>