---
import { type CollectionEntry, getCollection } from 'astro:content';
import PostLayout from '../../layouts/PostLayout.astro';

export async function getStaticPaths() {
	const poems = await getCollection('poems');
	const isDev = import.meta.env.DEV;
	
	const visiblePoems = poems.filter(poem => 
		isDev || (!poem.data.draft && !poem.data.invisible)
	);
	
	return visiblePoems.map((poem) => ({
		params: { slug: poem.slug },
		props: poem,
	}));
}
type Props = CollectionEntry<'poems'>;

const poem = Astro.props;
const { Content } = await poem.render();
---

<PostLayout title={poem.data.title} date={poem.data.date} tags={poem.data.tags}>
	<Content />
</PostLayout>